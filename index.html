// Esta función se activa al cambiar de pestaña
document.getElementById('historial-tab').addEventListener('click', function() {
    const historialDiv = document.getElementById('resumenHoy');
    historialDiv.innerHTML = '<div class="text-center p-4">⌛ Cargando historial desde Google Sheets...</div>';

    fetch(URL_SCRIPT) // Al ser un GET, trae los datos
    .then(response => response.json())
    .then(data => {
        if (data.length === 0) {
            historialDiv.innerHTML = "Aún no hay asados registrados.";
            return;
        }

        // Invertimos para ver el más reciente primero
        const ultimosAsados = data.reverse().slice(0, 5); 
        
        let tablaHtml = `
            <div class="table-responsive">
                <table class="table table-sm table-hover mt-3">
                    <thead class="table-dark">
                        <tr>
                            <th>Fecha</th>
                            <th>Cortes</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${ultimosAsados.map(a => `
                            <tr>
                                <td>${new Date(a.fecha).toLocaleDateString()}</td>
                                <td class="small">${a.corte}</td>
                                <td><strong>${a.pesototal}kg</strong></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            <p class="small text-muted text-center mt-2">Mostrando los últimos 5 asados.</p>
        `;
        historialDiv.innerHTML = tablaHtml;

        // Actualizar estadísticas globales (opcional)
        document.getElementById('reporteRatio').innerText = data[0].pesototal + ' Kg'; 
    })
    .catch(err => {
        historialDiv.innerHTML = "Error al cargar datos. ¿Publicaste el script como 'Cualquiera'?";
        console.error(err);
    });
});
